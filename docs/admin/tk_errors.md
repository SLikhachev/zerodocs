# Протокол ошибок МИС ТФОМС

В актуальной версии приложения протокол ошибок выгруженный из МИС ТФОМС, обрабатывается
непосредственно сервисом [task_rest](./task_rest.md). В дальнейщем планируется пренести
обработку протокола в библиотеку [barsxml](barsxml.md).

Для построения в БД таблицы ошибок, необходимо загрузить _XML_ файл протокола
на сервер _Taskrest_. Имя загружаемого файла игнорируется, проверяется только расширение
имени.

Ошибки из протокола выгружаются в таблицу [рабочей БД](./workdb.md), владельцем записи
с ошибкой является пользователь, загрузивший протокол. Загруженные записи об ошибках
остаются в таблице до тех пор, пока не будет загружен новый протокол.

Файл протокола должен иметь определенную структуру. В актуальной версии приложения нет
возможности гибко настраивать структуру протокола.

## Актуальная структура протокола

```xml
<?xml version="1.0" encoding="utf-8" ?>
<FLK_P>
    <FNAME>FHТ25М250999_21119992.xml</FNAME>
    <FNAME_I>HM250999T25_21119992.xml</FNAME_I>
    <SCHET>
        <CODE>9992111</CODE>
        <CODE_MO>250999</CODE_MO>
        <YEAR>2021</YEAR>
        <MONTH>11</MONTH>
        <NSCHET>999211102</NSCHET>
    <DSCHET>2021-11-29</DSCHET>
    </SCHET>
    <ZAP>
        <N_ZAP>3367</N_ZAP>
        <SL>
            <SL_ID>1</SL_ID>
            <IDCASE>3367</IDCASE>
            <NHISTORY>3367</NHISTORY>
            <CARD/>
            <SMO>25011</SMO>
            <SMO_FOND>25011</SMO_FOND>
            <OTKAZ>
                <I_TYPE>910</I_TYPE>
                <COMMENT>-1 - Нет информации о страхованиях в ЦС ЕРЗ ОМС!</COMMENT>
            </OTKAZ>
            <OTKAZ>
                <I_TYPE>536</I_TYPE>
                <COMMENT/>
            </OTKAZ>
        </SL>
    </ZAP>
</FLK_P>
```
